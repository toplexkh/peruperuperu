!function(a){a.fn.yiiActiveForm=function(b){return h[b]?h[b].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof b&&b?(a.error("Method "+b+" does not exist on jQuery.yiiActiveForm"),!1):h.init.apply(this,arguments)};var e,b={beforeValidate:"beforeValidate",afterValidate:"afterValidate",beforeValidateAttribute:"beforeValidateAttribute",afterValidateAttribute:"afterValidateAttribute",beforeSubmit:"beforeSubmit",ajaxBeforeSend:"ajaxBeforeSend",ajaxComplete:"ajaxComplete",afterInit:"afterInit"},c={encodeErrorSummary:!0,errorSummary:".error-summary",validateOnSubmit:!0,errorCssClass:"has-error",successCssClass:"has-success",validatingCssClass:"validating",ajaxParam:"ajax",ajaxDataType:"json",validationUrl:void 0,scrollToError:!0,scrollToErrorOffset:0},d={id:void 0,name:void 0,container:void 0,input:void 0,error:".help-block",encodeError:!0,validateOnChange:!0,validateOnBlur:!0,validateOnType:!1,validationDelay:500,enableAjaxValidation:!1,validate:void 0,status:0,cancelled:!1,value:void 0,updateAriaInvalid:!0},f=function(b){e=a.Deferred(),b.data("yiiSubmitFinalizePromise",e.promise())},g=function(a){e&&(e.resolve(),e=void 0,a.removeData("yiiSubmitFinalizePromise"))},h={init:function(e,f){return this.each(function(){var g=a(this);if(!g.data("yiiActiveForm")){var j=a.extend({},c,f||{});void 0===j.validationUrl&&(j.validationUrl=g.attr("action")),a.each(e,function(b){e[b]=a.extend({value:u(g,this)},d,this),i(g,e[b])}),g.data("yiiActiveForm",{settings:j,attributes:e,submitting:!1,validated:!1,options:n(g)}),g.bind("reset.yiiActiveForm",h.resetForm),j.validateOnSubmit&&(g.on("mouseup.yiiActiveForm keyup.yiiActiveForm",":submit",function(){g.data("yiiActiveForm").submitObject=a(this)}),g.on("submit.yiiActiveForm",h.submitForm));var k=a.Event(b.afterInit);g.trigger(k)}})},add:function(b){var c=a(this);b=a.extend({value:u(c,b)},d,b),c.data("yiiActiveForm").attributes.push(b),i(c,b)},remove:function(b){var c=a(this),d=c.data("yiiActiveForm").attributes,e=-1,f=void 0;return a.each(d,function(a){if(d[a].id==b)return e=a,f=d[a],!1}),e>=0&&(d.splice(e,1),j(c,f)),f},validateAttribute:function(b){var c=h.find.call(this,b);void 0!=c&&k(a(this),c,!0)},find:function(b){var c=a(this).data("yiiActiveForm").attributes,d=void 0;return a.each(c,function(a){if(c[a].id==b)return d=c[a],!1}),d},destroy:function(){return this.each(function(){a(this).unbind(".yiiActiveForm"),a(this).removeData("yiiActiveForm")})},data:function(){return this.data("yiiActiveForm")},validate:function(c){c&&(a(this).data("yiiActiveForm").submitting=!0);var d=a(this),e=d.data("yiiActiveForm"),f=!1,h={},i=l(),j=e.submitting&&!c;if(e.submitting){var k=a.Event(b.beforeValidate);if(d.trigger(k,[h,i]),!1===k.result)return e.submitting=!1,void g(d)}a.each(e.attributes,function(){if(this.$form=d,!a(this.input).is(":disabled")&&(this.cancelled=!1,e.submitting||2===this.status||3===this.status)){var c=h[this.id];void 0===c&&(c=[],h[this.id]=c);var g=a.Event(b.beforeValidateAttribute);d.trigger(g,[this,c,i]),!1!==g.result?(this.validate&&this.validate(this,u(d,this),c,i,d),this.enableAjaxValidation&&(f=!0)):this.cancelled=!0}}),a.when.apply(this,i).always(function(){for(var c in h)0===h[c].length&&delete h[c];if(f&&(a.isEmptyObject(h)||e.submitting)){var i=e.submitObject,k="&"+e.settings.ajaxParam+"="+d.attr("id");i&&i.length&&i.attr("name")&&(k+="&"+i.attr("name")+"="+i.attr("value")),a.ajax({url:e.settings.validationUrl,type:d.attr("method"),data:d.serialize()+k,dataType:e.settings.ajaxDataType,complete:function(a,c){d.trigger(b.ajaxComplete,[a,c])},beforeSend:function(a,c){d.trigger(b.ajaxBeforeSend,[a,c])},success:function(b){null!==b&&"object"==typeof b?(a.each(e.attributes,function(){this.enableAjaxValidation&&!this.cancelled||delete b[this.id]}),q(d,a.extend(h,b),j)):q(d,h,j)},error:function(){e.submitting=!1,g(d)}})}else e.submitting?setTimeout(function(){q(d,h,j)},200):q(d,h,j)})},submitForm:function(){var c=a(this),d=c.data("yiiActiveForm");if(d.validated){d.submitting=!1;var e=a.Event(b.beforeSubmit);return c.trigger(e),!1===e.result?(d.validated=!1,g(c),!1):(r(c),!0)}return f(c),void 0!==d.settings.timer&&clearTimeout(d.settings.timer),d.submitting=!0,h.validate.call(c),!1},resetForm:function(){var b=a(this),c=b.data("yiiActiveForm");setTimeout(function(){a.each(c.attributes,function(){this.value=u(b,this),this.status=0;var a=b.find(this.container);a.removeClass(c.settings.validatingCssClass+" "+c.settings.errorCssClass+" "+c.settings.successCssClass),a.find(this.error).html("")}),b.find(c.settings.errorSummary).hide().find("ul").html("")},1)},updateMessages:function(b,c){var d=a(this),e=d.data("yiiActiveForm");a.each(e.attributes,function(){s(d,this,b)}),c&&t(d,b)},updateAttribute:function(b,c){var d=h.find.call(this,b);if(void 0!=d){var e={};e[b]=c,s(a(this),d,e)}}},i=function(b,c){var d=v(b,c);c.validateOnChange&&d.on("change.yiiActiveForm",function(){k(b,c,!1)}),c.validateOnBlur&&d.on("blur.yiiActiveForm",function(){0!=c.status&&1!=c.status||k(b,c,!0)}),c.validateOnType&&d.on("keyup.yiiActiveForm",function(d){-1===a.inArray(d.which,[16,17,18,37,38,39,40])&&c.value!==u(b,c)&&k(b,c,!1,c.validationDelay)})},j=function(a,b){v(a,b).off(".yiiActiveForm")},k=function(b,c,d,e){var f=b.data("yiiActiveForm");d&&(c.status=2),a.each(f.attributes,function(){this.value!==u(b,this)&&(this.status=2,d=!0)}),d&&(void 0!==f.settings.timer&&clearTimeout(f.settings.timer),f.settings.timer=setTimeout(function(){f.submitting||b.is(":hidden")||(a.each(f.attributes,function(){2===this.status&&(this.status=3,b.find(this.container).addClass(f.settings.validatingCssClass))}),h.validate.call(b))},e||200))},l=function(){var b=[];return b.add=function(b){this.push(new a.Deferred(b))},b},m=["action","target","method","enctype"],n=function(a){for(var b={},c=0;c<m.length;c++)b[m[c]]=a.attr(m[c]);return b},o=function(a,b){for(var c=0;c<m.length;c++){var d=b.attr("form"+m[c]);d&&a.attr(m[c],d)}},p=function(a){for(var b=a.data("yiiActiveForm"),c=0;c<m.length;c++)a.attr(m[c],b.options[m[c]]||null)},q=function(c,d,e){var f=c.data("yiiActiveForm");if(void 0===f)return!1;if(e){var h=[];if(a.each(f.attributes,function(){a(this.input).is(":disabled")||this.cancelled||!s(c,this,d)||h.push(this)}),c.trigger(b.afterValidate,[d,h]),t(c,d),h.length){if(f.settings.scrollToError){var i=c.find(a.map(h,function(a){return a.input}).join(",")).first().closest(":visible").offset().top-f.settings.scrollToErrorOffset;i<0?i=0:i>a(document).height()&&(i=a(document).height());var j=a(window).scrollTop();(i<j||i>j+a(window).height())&&a(window).scrollTop(i)}f.submitting=!1}else f.validated=!0,f.submitObject&&o(c,f.submitObject),c.submit(),f.submitObject&&p(c)}else a.each(f.attributes,function(){this.cancelled||2!==this.status&&3!==this.status||s(c,this,d)});g(c)},r=function(b){var c=b.data("yiiActiveForm"),d=c.submitObject||b.find(":submit:first");if(d.length&&"submit"==d.attr("type")&&d.attr("name")){var e=a('input[type="hidden"][name="'+d.attr("name")+'"]',b);e.length?e.attr("value",d.attr("value")):a("<input>").attr({type:"hidden",name:d.attr("name"),value:d.attr("value")}).appendTo(b)}},s=function(c,d,e){var f=c.data("yiiActiveForm"),g=v(c,d),h=!1;if(a.isArray(e[d.id])||(e[d.id]=[]),c.trigger(b.afterValidateAttribute,[d,e[d.id]]),d.status=1,g.length){h=e[d.id].length>0;var i=c.find(d.container),j=i.find(d.error);w(c,d,h),h?(d.encodeError?j.text(e[d.id][0]):j.html(e[d.id][0]),i.removeClass(f.settings.validatingCssClass+" "+f.settings.successCssClass).addClass(f.settings.errorCssClass)):(j.empty(),i.removeClass(f.settings.validatingCssClass+" "+f.settings.errorCssClass+" ").addClass(f.settings.successCssClass)),d.value=u(c,d)}return h},t=function(b,c){var d=b.data("yiiActiveForm"),e=b.find(d.settings.errorSummary),f=e.find("ul").empty();e.length&&c&&(a.each(d.attributes,function(){if(a.isArray(c[this.id])&&c[this.id].length){var b=a("<li/>");d.settings.encodeErrorSummary?b.text(c[this.id][0]):b.html(c[this.id][0]),f.append(b)}}),e.toggle(f.find("li").length>0))},u=function(a,b){var c=v(a,b),d=c.attr("type");if("checkbox"===d||"radio"===d){var e=c.filter(":checked");return e.length||(e=a.find('input[type=hidden][name="'+c.attr("name")+'"]')),e.val()}return c.val()},v=function(a,b){var c=a.find(b.input);return c.length&&"div"===c[0].tagName.toLowerCase()?c.find("input"):c},w=function(a,b,c){b.updateAriaInvalid&&a.find(b.input).attr("aria-invalid",c?"true":"false")}}(window.jQuery);